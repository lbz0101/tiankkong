<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=0.5">
    <title>机械制图填空测评系统</title>
    <style>
        * {
            box-sizing: border-box;
            user-select: none;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #homepage {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 500px;
            margin: auto;
        }

        #loading {
            display: none;
            text-align: center;
            font-size: 18px;
            color: #666;
            margin-top: 20px;
        }

        #container {
            background-color: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            display: none;
            flex: 1;
            margin: 15px;
            overflow: auto;
        }

        .image-viewer {
            position: relative;
            height: 60vh;
            min-height: 300px;
            margin: 10px 0;
            border: 1px solid #ddd;
            background-color: #f8f8f8;
            overflow: hidden;
        }

        .image-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        #question-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            transition: transform 0.3s;
        }

        .image-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            z-index: 9999;
            padding: 20px;
        }

        .modal-content {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #zoomed-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 40px;
            cursor: pointer;
        }

        .question-block {
            margin: 20px 0;
            padding: 15px;
            border: 2px solid #2196F3;
            border-radius: 8px;
            background-color: #f8f9fa;
        }

        .question-number {
            font-size: 20px;
            color: #FF9800;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .blank-input {
            display: block;
            margin: 0 5px;
            width: 120px;
            border: none;
            border-bottom: 2px solid #666;
            padding: 5px 10px;
            font-size: 16px;
            text-align: left;
            background-color: transparent;
        }

        .correct {
            background-color: rgba(76, 175, 80, 0.1) !important;
        }

        .correct-answer {
            color: #f44336;
            font-size: 12px;
            display: block;
            margin-bottom: 5px;
            height: 18px;
        }

        #progress {
            text-align: center;
            font-size: 18px;
            color: #666;
            margin: 15px 0;
        }

        #student-select {
            width: 80%;
            padding: 12px;
            font-size: 16px;
            margin: 20px 0;
            border: 2px solid #2196F3;
            border-radius: 8px;
        }

        button {
            padding: 12px 40px;
            font-size: 18px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px;
        }

        #enter-btn { background-color: #2196F3; color: white; }
        #rank-btn { background-color: #FF9800; color: white; }
        #check-btn { background-color: #9C27B0; color: white; }
        #next-btn { background-color: #FF9800; color: white; display: none; }
        #finish-btn { background-color: #f44336; color: white; display: none; }

        #result-page {
            text-align: center;
            padding: 30px;
            display: none;
        }

        #ranking-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .ranking-content {
            background-color: white;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            margin: 30px auto;
            position: relative;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .ranking-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            margin: 5px 0;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .ranking-header {
            font-weight: bold;
            background-color: #e9ecef;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        #ranking-list {
            overflow-y: auto;
            flex-grow: 1;
            padding: 0 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div id="homepage">
        <h1 style="color: red;">由高州一职 Mr黎 制作</h1>
        <select id="student-select">
            <option value="">请选择学生姓名</option>
        </select>
        <br>
        <button id="enter-btn">开始测评</button>
        <button id="rank-btn">排行榜</button>
        <div id="loading">正在加载图片，请稍候...</div>
    </div>

    <div id="container">
        <div id="progress">第1/3页</div>
        
        <div class="image-viewer">
            <div class="image-container" onclick="showZoomedImage()">
                <img id="question-image" alt="题目图片">
            </div>
        </div>
        
        <div id="questions-container"></div>
        <div style="text-align:center;">
            <button id="check-btn" onclick="checkAnswers()">提交答案</button>
            <button id="next-btn" onclick="nextPage()">下一题</button>
            <button id="finish-btn" onclick="showFinalResult()">完成答题</button>
        </div>
    </div>

    <div class="image-modal" onclick="closeZoomedImage()">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <img id="zoomed-image" src="" alt="放大图片">
        </div>
    </div>

    <div id="result-page">
        <h2>测评结果</h2>
        <p id="total-score" style="font-size:24px; color:#2196F3;"></p>
        <button onclick="location.reload()">返回首页</button>
    </div>

    <div id="ranking-modal">
        <div class="ranking-content">
            <span class="close-btn" onclick="closeRanking()">&times;</span>
            <h2 style="text-align:center; color:#FF9800; margin:10px 0 20px;">学生排行榜</h2>
            <div class="ranking-item ranking-header">
                <span>排名</span>
                <span>姓名</span>
                <span>总得分</span>
                <span>用时</span>
            </div>
            <div id="ranking-list"></div>
        </div>
    </div>

<script>
const questionBank = {
    "1.jpg": [
        { answers: ["单燕尾滑块座", "45", "1：2"] },
        { answers: ["左视图", "俯视图", "一"] },
        { answers: ["0.021", "10.036"] },
        { answers: ["2", "18"] },
        { answers: ["4", "12.5"] },
        { answers: ["对称度", "0.05", "B"] }
    ],
    "2.jpg": [
        { answers: ["阀盖", "HT150", "1:1"] },
        { answers: ["2", "主", "左", "全剖视图"] },
        { answers: ["垂直度", "Φ35孔的轴线", "0.02", "B"] },
        { answers: ["35", "35", "34.075", "0.025"] }
    ],
    "3.jpg": [
        { answers: ["皮带轮", "HT150", "1：1"] },
        { answers: ["2", "全"] },
        { answers: ["30.03", "30", "0.03"] },
        { answers: ["圆跳动", "0.03", "A"] },
        { answers: ["3.2", "6.3"] },
        { answers: ["8", "3.3"] }
    ],
    "4.jpg": [
        { answers: ["从动轴", "40Cr", "1：1"] },
        { answers: ["60.021", "60.002", "0.019"] },
        { answers: ["39", "12.5"] },
        { answers: ["圆跳动", "0.015", "A-B"] },
        { answers: ["调质", "245-265HBS"] },
        { answers: ["14", "5.5"] }
    ],
    "5.jpg": [
        { answers: ["机座", "1：2"] },
        { answers: ["45", "调质"] },
        { answers: ["局部"] },
        { answers: ["0.066", "68.056", "67.99"] },
        { answers: ["Φ13", "6"] },
        { answers: ["8", "6.3"] },
        { answers: ["垂直度", "0.06", "A"] }
    ],
    "6.jpg": [
        { answers: ["夹头", "45", "1：1"] },
        { answers: ["2", "半", "局部"] },
        { answers: ["60.05", "59.95", "0.1"] },
        { answers: ["垂直度", "Φ0.08", "A"] },
        { answers: ["1.6", "6.3"] },
        { answers: ["时效处理"] }
    ],
    "7.jpg": [
        { answers: ["端盖", "HT150", "1：1"] },
        { answers: ["2", "主", "左", "旋转"] },
        { answers: ["垂直度", "0.02", "A"] },
        { answers: ["16", "16.018", "16", "16.018"] },
        { answers: ["1.6"] }
    ],
    "8.jpg": [
        { answers: ["夹具体", "1：2"] },
        { answers: ["HT150"] },
        { answers: ["局部"] },
        { answers: ["100", "72"] },
        { answers: ["0.05", "62.025", "61.075"] },
        { answers: ["2", "15"] },
        { answers: ["6.3"] },
        { answers: ["垂直度", "Φ0.03", "A"] }
    ],
    "9.jpg": [
        { answers: ["2", "旋转", "1：1"] },
        { answers: ["支座", "HT200"] },
        { answers: ["1.6", "25"] },
        { answers: ["垂直度", "Φ65孔的轴线", "B", "Φ0.01"] },
        { answers: ["左端面"] },
        { answers: ["65", "65.030", "65"] }
    ]
};

const studentList = ["张三","李四","王五","陈六"];
let currentStudent = "";
let currentPage = 1;
let totalScore = 0;
let usedImages = [];
let startTime = 0;
let imageCache = {};

function showZoomedImage() {
    const src = document.getElementById('question-image').src;
    document.getElementById('zoomed-image').src = src;
    document.querySelector('.image-modal').style.display = 'block';
}

function closeZoomedImage() {
    document.querySelector('.image-modal').style.display = 'none';
}

document.querySelector('.close-modal').onclick = closeZoomedImage;

function initHomepage() {
    const select = document.getElementById('student-select');
    studentList.forEach(student => {
        const option = document.createElement('option');
        option.value = student;
        option.textContent = student;
        select.appendChild(option);
    });

    document.getElementById('enter-btn').addEventListener('click', startTest);
    document.getElementById('rank-btn').addEventListener('click', showRanking);
}

function preloadImages() {
    document.getElementById('enter-btn').disabled = true;
    document.getElementById('loading').style.display = 'block';
    
    const imageNames = Object.keys(questionBank);
    let loadedCount = 0;
    
    imageNames.forEach(imageName => {
        const img = new Image();
        img.onload = function() {
            imageCache[imageName] = img;
            loadedCount++;
            if(loadedCount === imageNames.length) {
                document.getElementById('enter-btn').disabled = false;
                document.getElementById('loading').style.display = 'none';
            }
        };
        img.src = `images/${imageName}`;
    });
}

function startTest() {
    currentStudent = document.getElementById('student-select').value;
    if (!currentStudent) return alert('请先选择学生');
    startTime = Date.now();
    
    const allImages = Object.keys(questionBank);
    usedImages = [];
    while(usedImages.length < 3) {
        const randomImage = allImages[Math.floor(Math.random() * allImages.length)];
        if(!usedImages.includes(randomImage)) usedImages.push(randomImage);
    }

    document.getElementById('homepage').style.display = 'none';
    document.getElementById('container').style.display = 'block';
    currentPage = 1;
    totalScore = 0;
    loadNewPage();
}

function loadNewPage() {
    const currentImage = usedImages[currentPage-1];
    const img = document.getElementById('question-image');
    img.src = imageCache[currentImage].src;
    
    createQuestions(questionBank[currentImage]);
    document.getElementById('progress').textContent = `第${currentPage}/3页`;
    document.getElementById('check-btn').style.display = 'block';
    document.getElementById('next-btn').style.display = 'none';
    document.getElementById('finish-btn').style.display = 'none';
}

function createQuestions(questions) {
    const container = document.getElementById('questions-container');
    container.innerHTML = '';
    
    questions.forEach((q, index) => {
        const questionDiv = document.createElement('div');
        questionDiv.className = 'question-block';
        questionDiv.innerHTML = `
            <div class="question-number">（${index + 1}）</div>
            ${q.answers.map(() => `
                <div style="display: inline-block; vertical-align: top;">
                    <span class="correct-answer"></span>
                    <input type="text" class="blank-input">
                </div>
            `).join(' ')}
        `;
        container.appendChild(questionDiv);
    });
}

function checkAnswers() {
    const questions = questionBank[usedImages[currentPage-1]];
    const inputs = document.querySelectorAll('.blank-input');
    const answerSpans = document.querySelectorAll('.correct-answer');
    
    let correctCount = 0;
    let currentIndex = 0;
    
    questions.forEach((q, qIndex) => {
        q.answers.forEach((ans, aIndex) => {
            const input = inputs[currentIndex];
            const span = answerSpans[currentIndex];
            
            if (input.value.trim() === ans) {
                input.classList.add('correct');
                correctCount++;
                span.textContent = '';
            } else {
                input.classList.remove('correct');
                span.textContent = ans;
                span.style.color = '#f44336';
            }
            currentIndex++;
        });
    });
    
    totalScore += correctCount * 3;
    document.getElementById('check-btn').style.display = 'none';
    
    if(currentPage < 3) {
        document.getElementById('next-btn').style.display = 'inline-block';
    } else {
        document.getElementById('finish-btn').style.display = 'inline-block';
    }
}

function nextPage() {
    currentPage++;
    if(currentPage <= 3) {
        loadNewPage();
    }
}

function showFinalResult() {
    const finalScore = totalScore + 1;
    const timeUsed = Math.floor((Date.now() - startTime)/1000);
    const minutes = Math.floor(timeUsed/60);
    const seconds = timeUsed%60;
    
    document.getElementById('container').style.display = 'none';
    document.getElementById('result-page').style.display = 'block';
    document.getElementById('total-score').innerHTML = `
        考生：${currentStudent}<br>
        最终得分：<strong>${finalScore}</strong> 分<br>
        用时：${minutes}分${seconds}秒
    `;
}

function showRanking() {
    const ranking = studentList.map(student => {
        return {
            name: student,
            score: Math.floor(Math.random() * 100),
            time: `${Math.floor(Math.random() * 5)}分${Math.floor(Math.random() * 60)}秒`
        };
    }).sort((a, b) => b.score - a.score);

    const list = document.getElementById('ranking-list');
    list.innerHTML = ranking.map((item, index) => `
        <div class="ranking-item">
            <span>${index + 1}</span>
            <span>${item.name}</span>
            <span>${item.score}分</span>
            <span>${item.time}</span>
        </div>
    `).join('');
    
    document.getElementById('ranking-modal').style.display = 'block';
}

function closeRanking() {
    document.getElementById('ranking-modal').style.display = 'none';
}

window.onload = function() {
    initHomepage();
    preloadImages();
};
</script>
</body>
</html>
